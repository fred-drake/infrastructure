# Repository image information
image:
  repository: ghcr.io/fred-drake/k8s-backup
  tag: 0.2.1

# The S3 repository that we connect to for storage
restic:
  repository: "s3:http://minio.backup.svc.cluster.local:9000/restic"

# REQUIRED: S3 credentials.  In my implementation these are stored as SOPS secrets.
# s3:
#   user: myusername
#   password: mypassword

# REQUIRED: the restic password for the repository.  In my implementation this is
# stored as a SOPS secret.
# restic:
#   password: mysecretpassword

# OPTIONAL: Exactly one of "claimName" or "claims".  Omit both to not have any backup
# of persistent volume claims.  Setting both will throw an error.
#
# A single PVC claim name that this pod will connect to and backup.  Use this if your
# service pod has only one claim to back up.
# claimName: service-config
#
# A list of claims that this pod will connect to and backup, separated by sub-path 
# directories.  The below example will backup to /backup/NAMESPACE/config and
# /backup/NAMESPACE/data.
# claims:
#   - name: service-config
#     subPath: config
#   - name: service-data
#     subPath: data

# REQUIRED if "claimName" or "claims" is set: This backup pod must run on the same node in 
# order to connect to the same PVC.  Set the key and values to match the pod who is using the PVC.
# affinity:
#  key: app.kubernetes.io/name
#  values:
#    - my-application

# OPTIONAL: in addition to volumes set in the "claimName" or "claims" settings, you can set additional
# types of backups:
#  * postgresql - back up a dump of a postgresql database
#  * prometheus - takes a snapshot and backs it up.  Note that you to enable your admin API for this to work.
# backupTypes:
#   - postgresql

# OPTIONAL: Sets a subdirectory to back up.  In the below example, restic will only back up
# the /backup/my-application/foo/bar directory.  If this is not set, it will back up
# /backup/my-application.
# subdir: /foo/bar

# REQUIRED if a "backupTypes" list is set with "postgresql" as one of the elements.  This provides
# the necessary information for the database.
# postgresql:
#   host: postgres.my-service
#   user: myuser
#   password: supersecretpassword
#   database: myservice
#   backupFile: my-service.sql
