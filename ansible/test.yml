---
- hosts: k8s_rpi_master
  gather_facts: false
  become: true
  tasks:
  # - name: create temporary file
  #   ansible.builtin.tempfile:
  #     state: file
  #     suffix: temp
  #   register: tempfile_1
  #   changed_when: False

  # - name: pull latest longhorn block storage
  #   ansible.builtin.get_url:
  #     url: https://raw.githubusercontent.com/longhorn/longhorn/v1.1.2/deploy/longhorn.yaml
  #     dest: "{{ tempfile_1.path }}"
  #     mode: '0664'
  #   changed_when: False

  # - name: apply longhorn block storage
  #   k8s:
  #     kubeconfig: "{{ kubeconfig_location }}"
  #     state: present
  #     src: "{{ tempfile_1.path }}"
  #     wait: true
  #     wait_sleep: 5
  #     wait_timeout: 600
  #     wait_condition:
  #       type: "Ready"
  #       status: "True"
    - name: wait for longhorn to come up
      k8s:
        kubeconfig: "{{ kubeconfig_location }}"
        kind: Pod
        wait: true
        namespace: longhorn-system
        wait_sleep: 2
        wait_timeout: 600
        wait_condition:
          type: Ready
          status: "True"
