- name: Run routines common to master node manipulation
  ansible.builtin.include_role:
    name: swarm/master-common

- name: Add manager to swarm
  community.docker.docker_swarm:
    state: join
    join_token: "{{ hostvars[groups['swarm_initial_master'][0]]['manager_token']['stdout'] }}"
    remote_addrs: "{{ hostvars[groups['swarm_initial_master'][0]]['ansible_default_ipv4']['address'] }}:2377"
  when: swarm_status.rc != 0
