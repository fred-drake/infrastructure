- name: Check if token is available
  ansible.builtin.fail:
    msg: Cannot find token.  Did you not include the swarm initial master in the host list?
  when: hostvars[groups['swarm_initial_master'][0]]['worker_token'] is undefined
- name: Add worker to the swarm
  community.docker.docker_swarm:
    state: join
    join_token: "{{ hostvars[groups['swarm_initial_master'][0]]['worker_token']['stdout'] }}"
    remote_addrs: "{{ hostvars[groups['swarm_initial_master'][0]]['ansible_default_ipv4']['address'] }}:2377"
