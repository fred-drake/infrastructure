- name: Get IP address
  ansible.builtin.set_fact:
    host_ip_addr: "{{ lookup('dig', '{{ inventory_hostname }}.{{ secret.domain }}') }}"

- name: Call reset and reboot netbooted server
  ansible.builtin.command: "talosctl reset --graceful=false --reboot -n {{ host_ip_addr }}"
  when: netboot_server

- name: Call reset and reboot server
  ansible.builtin.command: >
    talosctl reset --system-labels-to-wipe STATE --system-labels-to-wipe EPHEMERAL
    --graceful=false --reboot -n {{ host_ip_addr }}
  when: not netboot_server
