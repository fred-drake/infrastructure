- name: "Vol {{ k8s_namespace }}-{{ backup_directory }} / restoring volume"
  ansible.builtin.command: >
    kubectl cp -n {{ k8s_namespace }}
    {{ backup_root_directory }}/{{ k8s_namespace }}/{{ backup_directory }} -c {{ container_name }}
    `kubectl get pod -n {{ k8s_namespace }} -o json | jq ".items[0].metadata.name" | tr -d \"`:{{ container_directory }}
  changed_when: true

- name: "Vol {{ k8s_namespace }}- - {{ backup_directory }} / setting user permissions"
  ansible.builtin.command: >
    kubectl exec -it `kubectl get pod -n {{ k8s_namespace }} -o json | jq ".items[0].metadata.name" | tr -d \"` --
    chown -R {{ k8s_user }} {{ container_directory }}/{{ backup_directory }}
  when: k8s_user is defined
  changed_when: true

- name: "Vol {{ k8s_namespace }}- - {{ backup_directory }} / setting group permissions"
  ansible.builtin.command: >
    kubectl exec -it `kubectl get pod -n {{ k8s_namespace }} -o json | jq ".items[0].metadata.name" | tr -d \"` --
    chgrp -R {{ k8s_group }} {{ container_directory }}/{{ backup_directory }}
  when: k8s_group is defined
  changed_when: true

- name: "Vol {{ k8s_namespace }}-{{ backup_directory }} / bouncing pod"
  ansible.builtin.command: >
    kubectl -n {{ k8s_namespace }} delete pod `kubectl get pod -n {{ k8s_namespace }} -o json | jq ".items[0].metadata.name" | tr -d \"`
  when: bounce_pod | default(true)
  changed_when: true
