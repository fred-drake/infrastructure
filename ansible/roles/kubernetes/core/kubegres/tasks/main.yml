---
- name: create temporary file
  ansible.builtin.tempfile:
    state: file
    suffix: temp
  register: tempfile_1
  changed_when: False
  tags: kubegres

- name: pull kubegres
  ansible.builtin.get_url:
    url: "https://raw.githubusercontent.com/reactive-tech/kubegres/v{{ k8s.kubegres.version }}/kubegres.yaml"
    dest: "{{ tempfile_1.path }}"
    mode: '0664'
  changed_when: False
  tags: kubegres

- name: apply kubegres
  k8s:
    state: present
    src: "{{ tempfile_1.path }}"
  tags: kubegres

- name: delete kubegres namespace
  k8s:
    name: kubegres-system
    api_version: v1
    kind: Namespace
    state: absent
  tags:
    - never
    - delete_kubegres
