- name: Get gluster facts
  ansible.builtin.include_role:
    name: glusterfs-server
    tasks_from: node_common

- name: Remove brick
  delegate_to: "{{ acting_node }}"
  ansible.builtin.command:
    cmd: "gluster --mode=script volume remove-brick vol01 replica 2 {{ inventory_hostname }}:/export/brick0/vol01 force"
  changed_when: true
  when: num_bricks.stdout | int == 3

- name: Delete peer from pool
  delegate_to: "{{ acting_node }}"
  gluster.gluster.gluster_peer:
    state: absent
    nodes:
      - "{{ inventory_hostname }}"
    force: true
  when: num_peers.stdout | int == 3
