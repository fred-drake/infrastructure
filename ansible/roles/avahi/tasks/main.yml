---
- name: Install avahi daemon
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
    update_cache: true
  loop:
    - avahi-daemon
    - avahi-utils
  tags:
    - avahi_update

- name: Copy configuration file
  ansible.builtin.copy:
    src: avahi-daemon.conf
    dest: /etc/avahi/avahi-daemon.conf
    mode: '0644'
  notify:
    - restart avahi
  tags:
    - avahi_update

- name: Execute service restart if necessary
  ansible.builtin.meta: flush_handlers
  tags:
    - avaihi_update

- name: Check if service is started
  ansible.builtin.service:
    name: avahi-daemon
    state: started
  notify:
    - fail because service is stopped
  tags:
    - avahi_update
