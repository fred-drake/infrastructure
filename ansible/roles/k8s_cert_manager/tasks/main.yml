---
- name: create cert-manager namespace
  k8s:
    name: cert-manager
    api_version: v1
    kind: Namespace
    state: present
  tags: 
    - cert_manager
    - k8s_setup

- name: apply cert-manager
  k8s:
    state: present
    definition: "{{ lookup('template', 'cert-manager.yml') | from_yaml_all }}"
  notify: wait for package
  tags: 
    - cert_manager
    - k8s_setup

- name: wait if we just applied cert-manager
  meta: flush_handlers
  tags:
    - k8s_setup

- name: apply cert-manager configuration
  k8s:
    state: present
    definition: "{{ lookup('template', 'cert-manager-config.yml') | from_yaml_all }}"
  tags: 
    - cert_manager
    - k8s_setup

- name: delete cert-manager
  k8s:
    name: cert-manager
    api_version: v1
    kind: Namespace
    state: absent
  tags: 
    - never
    - delete_cert_manager
