- name: install prerequisite library
  apt:
    name:
      - python3-venv

- name: check for existing tinypilot installation
  stat:
    path: /opt/tinypilot
  register: tp_dir

- name: install tinypilot
  shell: curl --silent --show-error https://raw.githubusercontent.com/tiny-pilot/tinypilot/master/quick-install | bash -
  notify: reboot
  when: not tp_dir.stat.exists

- name: overwrite settings
  template:
    src: settings.yml.j2
    dest: /home/tinypilot/settings.yml
    owner: tinypilot
    group: tinypilot
    mode: '0644'
  notify: reboot

