- name: Check for dns file
  run_once: true
  ansible.builtin.stat:
    path: "{{ playbook_dir }}/../roles/pihole/files/dns.txt"
  register: dns_file

- name: Fail if file doesn't exist
  run_once: true
  ansible.builtin.fail:
    msg: "DNS file not found in {{ playbook_dir }}/../roles/pihole/files/dns.txt. Create and copy contents from Obsidian."
  when: not dns_file.stat.exists

- name: Transfer pihole hosts
  run_once: true
  ansible.builtin.copy:
    src: dns.txt
    dest: /etc/pihole/custom.list
    mode: "0644"
    backup: true
  notify:
    - Restart DNS

- name: Flush handler
  ansible.builtin.meta: flush_handlers
