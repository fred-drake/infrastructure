---
- name: create application container
  community.docker.docker_container:
    name: "{{ role_name }}"
    image: "linuxserver/swag:latest"
    pull: "{{ container_pull }}"
    hostname: "{{ role_name }}"
    env:
      TZ: "{{ default_timezone }}"
      PUID: "99"
      PGID: "100"
      EMAIL: "{{ services.swag_internal.email }}"
      URL: "{{ services.swag_internal.url }}"
      SUBDOMAINS: "{{ services.swag_internal.subdomains }}"
      ONLY_SUBDOMAINS: "{{ services.swag_internal.only_subdomains }}"
      VALIDATION: "{{ services.swag_internal.validation }}"
      DNSPLUGIN: "{{ services.swag_internal.dnsplugin }}"
      STAGING: "{{ services.swag_internal.staging }}"
    volumes:
      - "{{ appdata_dir }}/swag-internal:/config"
    container_default_behavior: "{{ container_default_behavior }}"
    network_mode: "{{ container_network }}"
    restart_policy: unless-stopped
    networks:
      - name: "{{ container_network }}"
        ipv4_address: "{{ services.swag_internal.ip }}"
    networks_cli_compatible: "{{ container_networks_cli_compatible }}"
    state: "{{ container_state }}"
  notify:
    - deep prune docker
  tags:
    - swag_internal
    - docker_update

- name: sync proxy config files
  copy:
    src: "{{ item }}"
    dest: /var/lib/docker/mnt/appdata/swag-internal/nginx/proxy-confs/
    owner: "99"
    group: "100"
    mode: "0664"
  with_fileglob:
    - "*"
  notify:
    - restart nginx
  tags:
    - swag_internal
    - docker_update
