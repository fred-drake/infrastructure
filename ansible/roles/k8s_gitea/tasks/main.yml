- name: gitea database server
  k8s:
    state: present
    definition: "{{ lookup('template', 'gitea-db.yml') | from_yaml_all }}"
  tags:
    - gitea_db
    - gitea_all

- name: delete gitea database server
  k8s:
    state: absent
    definition: "{{ lookup('template', 'gitea-db.yml') | from_yaml_all }}"
  tags:
    - never
    - delete_gitea_db
    - delete_gitea_all

- name: gitea server
  k8s:
    state: present
    definition: "{{ lookup('template', 'gitea.yml') | from_yaml_all }}"
  tags:
    - gitea
    - gitea_all

- name: delete gitea server
  k8s:
    state: absent
    definition: "{{ lookup('template', 'gitea.yml') | from_yaml_all }}"
  tags:
    - never
    - delete_gitea
    - delete_gitea_all

- name: rollout restart gitea database server
  become: true
  command: kubectl rollout restart statefulset gitea-db -n gitea
  tags:
    - never
    - restart_gitea
    - restart_gitea_all

- name: rollout restart gitea server
  become: true
  command: kubectl rollout restart deployment gitea -n gitea
  tags:
    - never
    - restart_gitea
    - restart_gitea_all
